angular.module("objective-fire").factory("FactoryExtender",["$FirebaseObject","$firebase","$q","ObjectArray",function(a,b,c,d){return{createFactory:function(b,e,f){var g={},h=b.properties,i=h.primitive,j=h.objectP,k=h.arrayP,l=b.objectMethods;for(param in l)g[param]=l[param];return g.$load=function(a){var g=c.defer();if(this._doLoad[a])g.resolve(this[a]);else{for(var h=void 0,i="",l=0;l<j.length;l++)if(j[l].name===a){h=j[l],i="op";break}for(var l=0;l<k.length;l++)if(k[l].name===a){h=k[l],i="oap";break}if(this._doLoad[a]=!0,this._loaded){if("op"===i){var m=h.objectClassName,n=f.getObjectClass(m),o=n.instance(this[a]);this[a]=o,this._isLoaded[a]=!0,g.resolve(this[a])}else if("oap"===i){var m=h.objectClassName,n=f.getObjectClass(m),p=new d(e.child(b.name).child(this.$id).child(a),n);this[a]=p,this._isLoaded[a]=!0,g.resolve(this[a])}}else this.$loaded().then(function(c){if(!c._isLoaded[a])if("op"===i){var j=h.objectClassName,k=f.getObjectClass(j),l=k.instance(c[a]);c[a]=l}else if("oap"===i){var j=h.objectClassName,k=f.getObjectClass(j),m=new d(e.child(b.name).child(c.$id).child(a),k);c[a]=m}c._isLoaded[a]=!0,g.resolve(c[a])})}return g.promise},g.$$updated=function(a){for(var c=!1,g=a.val(),h=0;h<i.length;h++){var l=i[h].name;g[l]==this[l]&&(c=!0),this[l]=g[l]}for(var h=0;h<j.length;h++){var l=j[h].name;if(this._doLoad[l]){var m=j[h].objectClassName,n=f.getObjectClass(m),o=n.instance(g[l]);angular.equals(o,this[l])||(c=!0),this._isLoaded[l]=!0,this[l]=o}else this[l]=g[l]}for(var h=0;h<k.length;h++){var l=k[h].name;if(this._doLoad[l]){var m=k[h].objectClassName,n=f.getObjectClass(m),p=new d(e.child(b.name).child(this.$id).child(l),n);angular.equals(p,this[l])||(c=!0),this._isLoaded[l]=!0,this[l]=p}else this[l]=g[l]}return c},g.$save=function(){for(var a={},c=0;c<i.length;c++){var d=i[c].name;a[d]=this[d]}for(var c=0;c<j.length;c++){var d=j[c].name;a[d]="object"==typeof this[d]?this[d].$id:this[d]}for(var c=0;c<k.length;c++){var d=k[c].name;if("object"==typeof this[d]){a[d]=[];for(var f=0;f<k[c].length;f++)a[d][f]=k[c][f]}else a[d]=this[d]}for(param in a)void 0===a[param]&&(a[param]=null);e.child(b.name).child(this.$id).set(a)},a.$extendFactory(g)}}}]),angular.module("objective-fire").factory("FireObject",["$firebase","FactoryExtender",function(a,b){function c(a,c,d){this.objectClass=a,this.rootRef=c,this.objFire=d,this.factory=b.createFactory(this.objectClass,this.rootRef,this.objFire)}return c.prototype["new"]=function(){var b=this.rootRef.child(this.objectClass.name).push(),c=a(b,{objectFactory:this.factory}),d=c.$asObject();d._loaded=!1,d.$loaded().then(function(){d._loaded=!0}),d._isLoaded={},d._doLoad={},d.pointers={},null!=this.objectClass.objectConstructor&&this.objectClass.objectConstructor.apply(d,arguments);for(var e=this.objectClass.properties,f=e.objectP,g=(e.arrayP,0);g<f.length;g++){var h=f[g].name;h in d&&(d._isLoaded[h]=!0,d._doLoad[h]=!0)}return d.$save(),d},c.prototype.instance=function(b){var c=this.rootRef.child(this.objectClass.name).child(b),d=a(c,{objectFactory:this.factory}),e=d.$asObject();return e._loaded=!1,e.$loaded().then(function(){e._loaded=!0}),e._isLoaded={},e._doLoad={},e.pointers={},e},c}]),angular.module("objective-fire").factory("ObjectArray",["$FirebaseArray","$firebase",function(a,b){var c=function(b){return a.$extendFactory({$$added:function(a){return b.instance(a.val())},$$updated:function(a){var c=!1,d=this.$getRecord(a.val()),e=b.instance(a.val());return angular.equals(d,e)||(change=!0),c}})};return function(a,d){var e=b(a,{arrayFactory:c(d)}),f=e.$asArray();return f}}]),angular.module("objective-fire").factory("ObjectClass",function(){function a(b,c,d,e){return!this instanceof a?new a(b,c,d,e):(this.name=b,this.objectConstructor=c,this.objectMethods=d,void(this.properties=e))}return a}),angular.module("objective-fire",["firebase"]).factory("ObjectiveFire",["FireObject",function(a){function b(a){return!this instanceof b?new b(a):(this.ref=a,void(this.objects={}))}return b.prototype={registerObjectClass:function(b){return this.objects[b.name]=new a(b,this.ref,this),this},getObjectClass:function(a){return this.objects[a]}},b}]),angular.module("objective-fire").factory("ObjectProperty",function(){function a(b,c){return!this instanceof a?new a(b,c):(this.name=b,void(this.objectClassName=c))}return a}).factory("ObjectArrayProperty",function(){function a(b,c){return!this instanceof ObjectProperty?new a(b,c):(this.name=b,void(this.objectClassName=c))}return a}).factory("PrimitiveProperty",function(){function a(b){return!this instanceof a?new a(b):void(this.name=b)}return a}).factory("Properties",["PrimitiveProperty","ObjectProperty","ObjectArrayProperty",function(a,b,c){function d(){return!this instanceof d?new d:(this.primitive=[],this.objectP=[],void(this.arrayP=[]))}return d.prototype={addProperty:function(d){return d instanceof a?this.primitive.push(d):d instanceof b?this.objectP.push(d):d instanceof c&&this.arrayP.push(d),this}},d}]);