angular.module("objective-fire").factory("FactoryExtender",["$FirebaseObject","$firebase","$q","ObjectArray",function(a,b,c){return{createFactory:function(b,d,e){var f={},g=b.properties,h=g.primitive,i=g.objectP,j=g.arrayP,k=b.objectMethods;for(param in k)f[param]=k[param];return f.$load=function(a){var b=c.defer();if(this._doLoad[a])b.resolve(this[a]);else{for(var d=void 0,f=0;f<i.length;f++)if(i[f].name===a){d=i[f];break}for(var f=0;f<j.length;f++)if(j[f].name===a){d=j[f];break}if(this._doLoad[a]=!0,this._loaded){var g=d.objectClassName,h=e.getObjectClass(g),k=h.instance(this[a]);this[a]=k,this._isLoaded[a]=!0,b.resolve(k)}else this.$loaded().then(function(c){if(!c._isLoaded[a]){var f=d.objectClassName,g=e.getObjectClass(f),h=g.instance(c[a]);c[a]=h}c._isLoaded[a]=!0,b.resolve(c[a])})}return b.promise},f.$$updated=function(a){for(var b=!1,c=a.val(),d=0;d<h.length;d++){var f=h[d].name;c[f]==this[f]&&(b=!0),this[f]=c[f]}for(var d=0;d<i.length;d++){var f=i[d].name;if(this._doLoad[f]){var g=i[d].objectClassName,j=e.getObjectClass(g),k=j.instance(c[f]);angular.equals(k,this[f])||(b=!0),this._isLoaded[f]=!0,this[f]=k}else this[f]=c[f]}return b},f.$save=function(){for(var a={},c=0;c<h.length;c++){var e=h[c].name;a[e]=this[e]}for(var c=0;c<i.length;c++){var e=i[c].name;a[e]="object"==typeof this[e]?this[e].$id:this[e]}for(param in a)void 0===a[param]&&(a[param]=null);d.child(b.name).child(this.$id).set(a)},a.$extendFactory(f)}}}]),angular.module("objective-fire").factory("FireObject",["$firebase","FactoryExtender",function(a,b){function c(a,c,d){this.objectClass=a,this.rootRef=c,this.objFire=d,this.factory=b.createFactory(this.objectClass,this.rootRef,this.objFire)}return c.prototype["new"]=function(){var b=this.rootRef.child(this.objectClass.name).push(),c=a(b,{objectFactory:this.factory}),d=c.$asObject();d._loaded=!1,d.$loaded().then(function(){d._loaded=!0}),d._isLoaded={},d._doLoad={},d.pointers={},null!=this.objectClass.objectConstructor&&this.objectClass.objectConstructor.apply(d,arguments);for(var e=this.objectClass.properties,f=e.objectP,g=(e.arrayP,0);g<f.length;g++){var h=f[g].name;h in d&&(d._isLoaded[h]=!0,d._doLoad[h]=!0)}return d.$save(),d},c.prototype.instance=function(b){var c=this.rootRef.child(this.objectClass.name).child(b),d=a(c,{objectFactory:this.factory}),e=d.$asObject();return e._loaded=!1,e.$loaded().then(function(){e._loaded=!0}),e._isLoaded={},e._doLoad={},e.pointers={},e},c}]),angular.module("objective-fire").factory("ObjectArray",function(a,b){var c=function(b){return a.$extendFactory({$$added:function(a){return b.instance(a.key())},$$updated:function(a){return this.$getRecord(a.key())=b.instance(a.key()),!0}})};return function(a,d){var e=b(a,{arrayFactory:c(d)}),f=e.$asArray();return f}}),angular.module("objective-fire").factory("ObjectClass",function(){function a(b,c,d,e){return!this instanceof a?new a(b,c,d,e):(this.name=b,this.objectConstructor=c,this.objectMethods=d,void(this.properties=e))}return a}),angular.module("objective-fire",["firebase"]).factory("ObjectiveFire",["FireObject",function(a){function b(a){return!this instanceof b?new b(a):(this.ref=a,void(this.objects={}))}return b.prototype={registerObjectClass:function(b){return this.objects[b.name]=new a(b,this.ref,this),this},getObjectClass:function(a){return this.objects[a]}},b}]),angular.module("objective-fire").factory("ObjectProperty",function(){function a(b,c){return!this instanceof a?new a(b,c):(this.name=b,void(this.objectClassName=c))}return a}).factory("ObjectArrayProperty",function(){function a(b,c){return!this instanceof ObjectProperty?new a(b,c):(this.name=b,void(this.objectClassName=c))}return a}).factory("PrimitiveProperty",function(){function a(b){return!this instanceof a?new a(b):void(this.name=b)}return a}).factory("Properties",["PrimitiveProperty","ObjectProperty","ObjectArrayProperty",function(a,b,c){function d(){return!this instanceof d?new d:(this.primitive=[],this.objectP=[],void(this.arrayP=[]))}return d.prototype={addProperty:function(d){return d instanceof a?this.primitive.push(d):d instanceof b?this.objectP.push(d):d instanceof c&&this.arrayP.push(d),this}},d}]);