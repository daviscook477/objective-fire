angular.module("objective-fire",["firebase"]).factory("ObjectiveFire",["FireObject",function(a){function b(a){return!this instanceof b?new b(a):(this.ref=a,void(this.objects={}))}return b.prototype={registerObjectClass:function(b){return this.objects[b.name]=new a(b,this.ref,this),this},getObjectClass:function(a){return this.objects[a]}},b}]),angular.module("objective-fire").factory("FactoryExtender",["$FirebaseObject","$firebase","$q","ObjectArray",function(a,b,c,d){return{createFactory:function(b,e,f){var g,h,i,j={},k=b.properties;null===k?(g=[],h=[],i=[]):(g=k.primitive,h=k.objectP,i=k.arrayP);var l=b.objectMethods;if("object"==typeof l)for(param in l)j[param]=l[param];return j.$load=function(a){var g=c.defer();if("string"!=typeof a)throw"name must be of type string";if(this._doLoad[a])g.resolve(this[a]);else{for(var j=void 0,k="",l=0;l<h.length;l++)if(h[l].name===a){j=h[l],k="op";break}for(var l=0;l<i.length;l++)if(i[l].name===a){j=i[l],k="oap";break}if(this._doLoad[a]=!0,this._loaded){if("op"===k){var m=j.objectClassName,n=f.getObjectClass(m),o=n.instance(this[a]);this[a]=o,this._isLoaded[a]=!0,g.resolve(this[a])}else if("oap"===k){var m=j.objectClassName,n=f.getObjectClass(m),p=new d(e.child(b.name).child(this.$id).child(a),n);this[a]=p,this._isLoaded[a]=!0,g.resolve(this[a])}}else this.$loaded().then(function(c){if(!c._isLoaded[a])if("op"===k){var h=j.objectClassName,i=f.getObjectClass(h),l=i.instance(c[a]);c[a]=l}else if("oap"===k){var h=j.objectClassName,i=f.getObjectClass(h),m=new d(e.child(b.name).child(c.$id).child(a),i);c[a]=m}c._isLoaded[a]=!0,g.resolve(c[a])})}return g.promise},j.$$updated=function(a){var c=!1,j=a.val();null===j&&(j={});for(var k=0;k<g.length;k++){var l=g[k].name;j[l]!==this[l]&&(c=!0),this[l]=j[l]}for(var k=0;k<h.length;k++){var l=h[k].name;if(this._doLoad[l]){var m=h[k].objectClassName,n=f.getObjectClass(m),o=n.instance(j[l]);angular.equals(o,this[l])||(c=!0),this._isLoaded[l]=!0,this[l]=o}else this[l]=j[l]}for(var k=0;k<i.length;k++){var l=i[k].name;if(this._doLoad[l]){var m=i[k].objectClassName,n=f.getObjectClass(m),p=new d(e.child(b.name).child(this.$id).child(l),n);angular.equals(p,this[l])||(c=!0),this._isLoaded[l]=!0,this[l]=p}else this[l]=j[l]}return c},j.$save=function(){for(var a={},c=0;c<g.length;c++){var d=g[c].name;a[d]=this[d]}for(var c=0;c<h.length;c++){var d=h[c].name;a[d]="object"==typeof this[d]?this[d].$id:this[d]}for(var c=0;c<i.length;c++){var d=i[c].name;if("object"==typeof this[d]){a[d]=[];for(var f=0;f<i[c].length;f++)a[d][f]=i[c][f]}else a[d]=this[d]}for(param in a)void 0===a[param]&&(a[param]=null);e.child(b.name).child(this.$id).set(a)},a.$extendFactory(j)}}}]),angular.module("objective-fire").factory("FireObject",["$firebase","FactoryExtender",function(a,b){function c(a,c,d){this.objectClass=a,this.rootRef=c,this.objFire=d,this.factory=b.createFactory(this.objectClass,this.rootRef,this.objFire)}return c.prototype["new"]=function(){var b=this.rootRef.child(this.objectClass.name).push(),c=a(b,{objectFactory:this.factory}),d=c.$asObject();if(d._loaded=!1,d.$loaded().then(function(){d._loaded=!0}),d._isLoaded={},d._doLoad={},d.pointers={},null==this.objectClass.objectConstructor||"function"!=typeof this.objectClass.objectConstructor)throw"new may only be called for classes that have constructors";this.objectClass.objectConstructor.apply(d,arguments);for(var e=this.objectClass.properties,f=e.objectP,g=e.arrayP,h=0;h<f.length;h++){var i=f[h].name;i in d&&(d._isLoaded[i]=!0,d._doLoad[i]=!0)}for(var h=0;h<g.length;h++){var i=g[h].name;i in d&&(d._isLoaded[i]=!0,d._doLoad[i]=!0)}return d.$save(),d},c.prototype.instance=function(b){var c=this.rootRef.child(this.objectClass.name).child(b),d=a(c,{objectFactory:this.factory}),e=d.$asObject();return e._loaded=!1,e.$loaded().then(function(){e._loaded=!0}),e._isLoaded={},e._doLoad={},e.pointers={},e},c}]),angular.module("objective-fire").factory("ObjectArray",["$FirebaseArray","$firebase",function(a,b){var c=function(b){return a.$extendFactory({$$added:function(a){return b.instance(a.val())},$$updated:function(a){var c=!1,d=this.$getRecord(a.val()),e=b.instance(a.val());return angular.equals(d,e)||(change=!0),c}})};return function(a,d){var e=b(a,{arrayFactory:c(d)}),f=e.$asArray();return f}}]),angular.module("objective-fire").factory("ObjectClass",function(){function a(b,c,d,e){if(!this instanceof a)return new a(b,c,d,e);if("string"!=typeof b)throw"name must be of type string";if("function"!=typeof c&&null!==c)throw"objectConstructor must be of type function or null";if("object"!=typeof d&&null!==d)throw"objectMethods must be of type object or null";if("object"!=typeof e&&null!==e)throw"properties must be of type object or null";this.name=b,this.objectConstructor=c,this.objectMethods=d,this.properties=e}return a}),angular.module("objective-fire").factory("ObjectProperty",function(){function a(b,c){if(!this instanceof a)return new a(b,c);if("string"!=typeof b)throw"name must be of type string";this.name=b,this.objectClassName=c}return a}).factory("ObjectArrayProperty",function(){function a(b,c){if(!this instanceof a)return new a(b,c);if("string"!=typeof b)throw"name must be of type string";this.name=b,this.objectClassName=c}return a}).factory("PrimitiveProperty",function(){function a(b){if(!this instanceof a)return new a(b);if("string"!=typeof b)throw"name must be of type string";this.name=b}return a}).factory("Properties",["PrimitiveProperty","ObjectProperty","ObjectArrayProperty",function(a,b,c){function d(){return!this instanceof d?new d:(this.primitive=[],this.objectP=[],void(this.arrayP=[]))}return d.prototype={addProperty:function(d){if(d instanceof a)this.primitive.push(d);else if(d instanceof b)this.objectP.push(d);else{if(!(d instanceof c))throw"property must be of type PrimitiveProperty || ObjectProperty || ObjectArrayProperty";this.arrayP.push(d)}return this}},d}]);